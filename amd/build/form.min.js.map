{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * blocks/taskchain_navigation.php\n *\n * @module     block_taskchain_navigation\n * @copyright  2021 Gordon Bateson (gordon.bateson@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      Moodle 2.9\n */\n\ndefine([\"core/str\"], function(STR) {\n\n    /** @alias module:block_taskchain_navigation/view */\n    var JS = {};\n\n    // cache the plugin name and string cache\n    JS.plugin = \"block_taskchain_navigation\";\n    JS.str = {};\n\n    /*\n     * initialize this AMD module\n     */\n    JS.init = function() {\n\n        STR.get_strings([\n            {\"key\": \"deselectall\",    \"component\": \"moodle\"},\n            {\"key\": \"selectall\",      \"component\": \"moodle\"},\n            {\"key\": \"apply\",          \"component\": JS.plugin},\n            {\"key\": \"exportsettings\", \"component\": JS.plugin},\n            {\"key\": \"importsettings\", \"component\": JS.plugin}\n        ]).done(function(s) {\n            var i = 0;\n            JS.str.deselectall    = s[i++];\n            JS.str.selectall      = s[i++];\n            JS.str.apply          = s[i++];\n            JS.str.exportsettings = s[i++];\n            JS.str.importsettings = s[i++];\n\n            var fieldsets = \"#id_title, #id_coursegradecategory, \"\n                          + \"#id_gradecategories, #id_gradecategorynames, \"\n                          + \"#id_categoryprefixes, #id_categorysuffixes, \"\n                          + \"#id_sections, #id_sectiontitles, \"\n                          + \"#id_sectionprefixes, #id_sectionsuffixes, \"\n                          + \"#id_groups, #id_grades, \"\n                          + \"#id_coursesections, #id_coursepageshortcuts, \"\n                          + \"#id_styles, #id_applyselectedvalues\";\n            JS.add_itemselect_checkboxes(fieldsets);\n\n            // Adjust vertical alignment of showactivitygrades, so that it\n            // is level with the top of the list of activity types.\n            JS.adjust_valign_and_padding(\"showactivitygrades\");\n        });\n    };\n\n    JS.add_itemselect_checkboxes = function(fieldsets){\n\n        // sm: for tablets - screens equal to or greater than 768px wide\n        // md: for small laptops - screens equal to or greater than 992px wide\n        var viewportwidth = Math.max(document.documentElement.clientWidth, (window.innerWidth || 0));\n        var smallviewport = (viewportwidth < 992);\n\n        var elm = document.querySelector(\"select[name^=config_mycourses]\");\n        if (elm) {\n            document.querySelectorAll(fieldsets).forEach(function(fieldset){\n                fieldset.querySelectorAll(\".row.fitem .col-md-9\").forEach(function(elm, i){\n\n                    var div = document.createElement(\"DIV\");\n\n                    var node = null;\n\n                    // get name of parent element e.g. \"fitem_id_description\"\n                    // and remove everything up to final underscore \"_\".\n                    var name = elm.parentNode.id;\n                    name = name.replace(new RegExp(\"^.+_\"), \"\");\n\n                    if (name == \"description\") {\n                        elm.classList.remove(\"col-md-9\");\n                        elm.classList.add(\"col-7\");\n                        //elm.classList.add(\"bg-light\");\n                        //elm.classList.add(\"border-top\");\n                        //elm.classList.add(\"border-bottom\");\n\n                        //div.classList.add(\"d-none\");\n                        //div.classList.add(\"d-md-block\");\n                        div.classList.add(\"col-5\");\n                        div.classList.add(\"col-md-2\");\n                        div.classList.add(\"px-0\");\n                        div.classList.add(\"text-right\");\n\n                        node = elm.querySelector(\".exportsettings\");\n                        if (node) {\n                            div.appendChild(node);\n                        }\n\n                        node = elm.querySelector(\".importsettings\");\n                        if (node) {\n                            div.appendChild(node);\n                        }\n\n                        var input = document.createElement(\"INPUT\");\n                        input.setAttribute(\"type\", \"checkbox\");\n                        input.setAttribute(\"name\", \"select_all\");\n                        input.setAttribute(\"id\", \"id_select_all\");\n                        input.classList.add(\"ml-2\");\n                        if (input.addEventListener) {\n                            input.addEventListener(\"change\", JS.onchange_selectall, false);\n                        } else if (input.attachEvent) {\n                            input.attachEvent(\"onchange\", JS.onchange_selectall);\n                        }\n\n                        var label = document.createElement(\"LABEL\");\n                        label.setAttribute(\"for\", \"id_select_all\");\n                        label.classList.add(\"d-inline\");\n                        label.innerText = JS.str.selectall;\n\n                        node = document.createElement(\"DIV\");\n                        node.classList.add(\"bg-secondary\");\n                        if (i == 0 || smallviewport) {\n                            node.classList.add(\"border-top\");\n                        }\n                        node.classList.add(\"border-bottom\");\n                        node.classList.add(\"border-dark\");\n                        node.classList.add(\"w-100\"); // width: 100%\n                        node.classList.add(\"py-1\");\n                        node.classList.add(\"text-right\");\n                        if (smallviewport) {\n                            node.style.paddingRight = \"24px\";\n                        } else {\n                            node.style.paddingRight = \"35px\";\n                        }\n                        node.classList.add(\"itemselect\");\n\n                        node.appendChild(label);\n                        node.appendChild(input);\n\n                        div.appendChild(node);\n                    } else {\n                        elm.classList.remove(\"col-md-9\");\n                        elm.classList.add(\"col-10\");\n                        elm.classList.add(\"col-md-8\");\n\n                        //div.classList.add(\"d-none\");\n                        //div.classList.add(\"d-md-block\");\n                        div.classList.add(\"col-2\");\n                        div.classList.add(\"col-md-1\");\n                        div.classList.add(\"bg-secondary\");\n                        if (i == 0 || smallviewport) {\n                            div.classList.add(\"border-top\");\n                        }\n                        div.classList.add(\"border-bottom\");\n                        div.classList.add(\"border-dark\");\n                        div.classList.add(\"px-0\");\n                        div.classList.add(\"py-1\");\n                        div.classList.add(\"text-center\");\n                        div.classList.add(\"itemselect\");\n\n                        node = document.createElement(\"INPUT\");\n                        if (name == \"mycourses\") {\n                            // Create button to \"Apply\" settings.\n                            node.setAttribute(\"type\", \"submit\");\n                            node.setAttribute(\"value\", JS.str.apply);\n                            node.classList.add(\"btn\");\n                            node.classList.add(\"btn-primary\");\n                            node.classList.add(\"my-1\");\n                            node.classList.add(\"px-2\");\n                        } else {\n                            // Create checkbox for this setting.\n                            node.setAttribute(\"type\", \"checkbox\");\n                            node.setAttribute(\"name\", \"select_\" + name);\n                            node.setAttribute(\"id\", \"id_select_\" + name);\n                            node.classList.add(\"mt-2\");\n                        }\n\n                        div.appendChild(node);\n                    }\n\n                    elm.parentNode.insertBefore(div, elm.nextSibling);\n\n                    // Add zebra strip to odd numbered form items.\n                    if (elm.parentNode.matches(\":nth-child(odd)\")) {\n                        elm.parentNode.classList.add(\"bg-light\");\n                    }\n                });\n            });\n        }\n    };\n\n    JS.adjust_valign_and_padding = function(name){\n        var id = \"id_config_\" + name;\n        var elm = document.getElementById(id);\n        if (elm) {\n            elm = elm.closest(\".align-items-center\");\n            if (elm) {\n                elm.classList.remove(\"align-items-center\");\n                elm.classList.add(\"align-items-start\");\n            }\n        }\n        var id = \"id_config_\" + name + \"types\";\n        var elm = document.getElementById(id);\n        if (elm) {\n            elm.classList.add(\"py-0\");\n        }\n    };\n\n    JS.onchange_selectall = function(){\n        var checked = this.checked;\n        var label = this.parentNode.querySelector(\"label\");\n        if (label) {\n            label.innerText = (checked ? JS.str.deselectall : JS.str.selectall);\n        }\n        var s = \".itemselect input[type=checkbox]:not([name=\" + this.name + \"])\";\n        document.querySelectorAll(s).forEach(function(checkbox){\n            checkbox.checked = checked;\n        });\n    };\n\n    return JS;\n});"],"names":["define","STR","JS","get_strings","plugin","done","s","i","str","deselectall","selectall","apply","exportsettings","importsettings","add_itemselect_checkboxes","adjust_valign_and_padding","fieldsets","smallviewport","Math","max","document","documentElement","clientWidth","window","innerWidth","querySelector","querySelectorAll","forEach","fieldset","elm","div","createElement","node","name","parentNode","id","replace","RegExp","classList","remove","add","appendChild","input","setAttribute","addEventListener","onchange_selectall","attachEvent","label","innerText","style","paddingRight","insertBefore","nextSibling","matches","getElementById","closest","checked","this","checkbox"],"mappings":"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"}