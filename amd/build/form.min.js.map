{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * blocks/taskchain_navigation.php\n *\n * @module     block_taskchain_navigation\n * @copyright  2021 Gordon Bateson (gordon.bateson@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      Moodle 2.9\n */\n\ndefine([\"core/str\"], function(STR) {\n\n    /** @alias module:block_taskchain_navigation/view */\n    var JS = {};\n    window.JS = JS;\n\n    // cache the plugin name and string cache\n    JS.plugin = \"block_taskchain_navigation\";\n    JS.str = {};\n\n    /*\n     * initialize this AMD module\n     */\n    JS.init = function() {\n\n        STR.get_strings([\n            {\"key\": \"deselectall\",    \"component\": \"moodle\"},\n            {\"key\": \"selectall\",      \"component\": \"moodle\"},\n            {\"key\": \"apply\",          \"component\": JS.plugin},\n            {\"key\": \"exportsettings\", \"component\": JS.plugin},\n            {\"key\": \"importsettings\", \"component\": JS.plugin}\n        ]).done(function(s) {\n            var i = 0;\n            JS.str.deselectall    = s[i++];\n            JS.str.selectall      = s[i++];\n            JS.str.apply          = s[i++];\n            JS.str.exportsettings = s[i++];\n            JS.str.importsettings = s[i++];\n\n            // Check for obfuscated element IDs in blocks in Moodle >= 4.2\n            // e.g. id_title_m4YI21OUPqnjI5P\n            JS.obfuscation = new RegExp(\"_[^_]{15}$\");\n            JS.use_obfuscation = document.querySelector(\"fieldset\").id.match(JS.obfuscation);\n\n            var fieldsets = \"\";\n            if (JS.use_obfuscation) {\n                // Moodle >= 4.2\n                fieldsets = \"[id^=id_title_],\"\n                          + \"[id^=id_coursegradecategory_],\"\n                          + \"[id^=id_gradecategories_],\"\n                          + \"[id^=id_gradecategorynames_],\"\n                          + \"[id^=id_categoryprefixes_],\"\n                          + \"[id^=id_categorysuffixes_],\"\n                          + \"[id^=id_sections_],\"\n                          + \"[id^=id_sectiontitles_],\"\n                          + \"[id^=id_sectionprefixes_],\"\n                          + \"[id^=id_sectionsuffixes_],\"\n                          + \"[id^=id_groups_],\"\n                          + \"[id^=id_grades_],\"\n                          + \"[id^=id_coursesections_],\"\n                          + \"[id^=id_coursepageshortcuts_],\"\n                          + \"[id^=id_styles_],\"\n                          + \"[id^=id_applyselectedvalues_]\";\n            } else {\n                // Moodle <= 4.1\n                fieldsets = \"#id_title,\"\n                          + \"#id_coursegradecategory,\"\n                          + \"#id_gradecategories,\"\n                          + \"#id_gradecategorynames,\"\n                          + \"#id_categoryprefixes,\"\n                          + \"#id_categorysuffixes,\"\n                          + \"#id_sections,\"\n                          + \"#id_sectiontitles,\"\n                          + \"#id_sectionprefixes,\"\n                          + \"#id_sectionsuffixes,\"\n                          + \"#id_groups,\"\n                          + \"#id_grades,\"\n                          + \"#id_coursesections,\"\n                          + \"#id_coursepageshortcuts,\"\n                          + \"#id_styles,\"\n                          + \"#id_applyselectedvalues\";\n            }\n            JS.add_itemselect_checkboxes(fieldsets);\n\n            // Adjust vertical alignment of showactivitygrades, so that it\n            // is level with the top of the list of activity types.\n            JS.adjust_valign_and_padding(\"showactivitygrades\");\n        });\n    };\n\n    JS.add_itemselect_checkboxes = function(fieldsets){\n\n        // sm: for tablets - screens equal to or greater than 768px wide\n        // md: for small laptops - screens equal to or greater than 992px wide\n        var viewportwidth = Math.max(document.documentElement.clientWidth, (window.innerWidth || 0));\n        var smallviewport = (viewportwidth < 992);\n\n        var mycourses = document.querySelector(\"select[name^=config_mycourses]\");\n\n        document.querySelectorAll(fieldsets).forEach(function(fieldset){\n            fieldset.querySelectorAll(\".row.fitem .col-md-9\").forEach(function(elm, i){\n                if (mycourses) {\n                    JS.add_itemselect_checkbox(elm, i, smallviewport);\n                }\n                // Add zebra strip to odd numbered form items.\n                if (elm.parentNode.matches(\":nth-child(odd)\")) {\n                    elm.parentNode.classList.add(\"bg-light\");\n                }\n            });\n        });\n    };\n\n    JS.add_itemselect_checkbox = function(elm, i, smallviewport){\n        var div = document.createElement(\"DIV\");\n\n        var node = null;\n\n        // Extract name of parent element from its id e.g. \"fitem_id_description\"\n        var name = elm.parentNode.id;\n        if (JS.use_obfuscation) {\n            // Remove obfuscation chars from the end of the id.\n            name = name.replace(JS.obfuscation, \"\");\n        }\n        // Remove everything up to, and including,the final underscore \"_\".\n        name = name.replace(new RegExp(\"^.+_\"), \"\");\n\n        if (name == \"description\") {\n            elm.classList.remove(\"col-md-9\");\n            elm.classList.add(\"col-7\");\n            //elm.classList.add(\"bg-light\");\n            //elm.classList.add(\"border-top\");\n            //elm.classList.add(\"border-bottom\");\n\n            //div.classList.add(\"d-none\");\n            //div.classList.add(\"d-md-block\");\n            div.classList.add(\"col-5\");\n            div.classList.add(\"col-md-2\");\n            div.classList.add(\"px-0\");\n            div.classList.add(\"text-right\");\n\n            node = elm.querySelector(\".exportsettings\");\n            if (node) {\n                div.appendChild(node);\n            }\n\n            node = elm.querySelector(\".importsettings\");\n            if (node) {\n                div.appendChild(node);\n            }\n\n            var input = document.createElement(\"INPUT\");\n            input.setAttribute(\"type\", \"checkbox\");\n            input.setAttribute(\"name\", \"select_all\");\n            input.setAttribute(\"id\", \"id_select_all\");\n            input.classList.add(\"ml-2\");\n            if (input.addEventListener) {\n                input.addEventListener(\"change\", JS.onchange_selectall, false);\n            } else if (input.attachEvent) {\n                input.attachEvent(\"onchange\", JS.onchange_selectall);\n            }\n\n            var label = document.createElement(\"LABEL\");\n            label.setAttribute(\"for\", \"id_select_all\");\n            label.classList.add(\"d-inline\");\n            label.innerText = JS.str.selectall;\n\n            node = document.createElement(\"DIV\");\n            node.classList.add(\"bg-secondary\");\n            if (i == 0 || smallviewport) {\n                node.classList.add(\"border-top\");\n            }\n            node.classList.add(\"border-bottom\");\n            node.classList.add(\"border-dark\");\n            node.classList.add(\"w-100\"); // width: 100%\n            node.classList.add(\"py-1\");\n            node.classList.add(\"text-right\");\n            if (smallviewport) {\n                node.style.paddingRight = \"24px\";\n            } else {\n                node.style.paddingRight = \"35px\";\n            }\n            node.classList.add(\"itemselect\");\n\n            node.appendChild(label);\n            node.appendChild(input);\n\n            div.appendChild(node);\n        } else {\n            elm.classList.remove(\"col-md-9\");\n            elm.classList.add(\"col-10\");\n            elm.classList.add(\"col-md-8\");\n\n            //div.classList.add(\"d-none\");\n            //div.classList.add(\"d-md-block\");\n            div.classList.add(\"col-2\");\n            div.classList.add(\"col-md-1\");\n            div.classList.add(\"bg-secondary\");\n            if (i == 0 || smallviewport) {\n                div.classList.add(\"border-top\");\n            }\n            div.classList.add(\"border-bottom\");\n            div.classList.add(\"border-dark\");\n            div.classList.add(\"px-0\");\n            div.classList.add(\"py-1\");\n            div.classList.add(\"text-center\");\n            div.classList.add(\"itemselect\");\n\n            node = document.createElement(\"INPUT\");\n            if (name == \"mycourses\") {\n                // Create button to \"Apply\" settings.\n                node.setAttribute(\"type\", \"submit\");\n                node.setAttribute(\"value\", JS.str.apply);\n                node.classList.add(\"btn\");\n                node.classList.add(\"btn-primary\");\n                node.classList.add(\"my-1\");\n                node.classList.add(\"px-2\");\n            } else {\n                // Create checkbox for this setting.\n                node.setAttribute(\"type\", \"checkbox\");\n                node.setAttribute(\"name\", \"select_\" + name);\n                node.setAttribute(\"id\", \"id_select_\" + name);\n                node.classList.add(\"mt-2\");\n            }\n\n            div.appendChild(node);\n        }\n\n        elm.parentNode.insertBefore(div, elm.nextSibling);\n    };\n\n    JS.adjust_valign_and_padding = function(name){\n        var id = \"id_config_\" + name;\n        var elm = document.getElementById(id);\n        if (elm) {\n            elm = elm.closest(\".align-items-center\");\n            if (elm) {\n                elm.classList.remove(\"align-items-center\");\n                elm.classList.add(\"align-items-start\");\n            }\n        }\n        var id = \"id_config_\" + name + \"types\";\n        var elm = document.getElementById(id);\n        if (elm) {\n            elm.classList.add(\"py-0\");\n        }\n    };\n\n    JS.onchange_selectall = function(){\n        var checked = this.checked;\n        var label = this.parentNode.querySelector(\"label\");\n        if (label) {\n            label.innerText = (checked ? JS.str.deselectall : JS.str.selectall);\n        }\n        var s = \".itemselect input[type=checkbox]:not([name=\" + this.name + \"])\";\n        document.querySelectorAll(s).forEach(function(checkbox){\n            checkbox.checked = checked;\n        });\n    };\n\n    return JS;\n});"],"names":["define","STR","JS","window","plugin","str","init","get_strings","done","s","i","deselectall","selectall","apply","exportsettings","importsettings","obfuscation","RegExp","use_obfuscation","document","querySelector","id","match","fieldsets","add_itemselect_checkboxes","adjust_valign_and_padding","smallviewport","Math","max","documentElement","clientWidth","innerWidth","mycourses","querySelectorAll","forEach","fieldset","elm","add_itemselect_checkbox","parentNode","matches","classList","add","div","createElement","node","name","replace","remove","appendChild","input","setAttribute","addEventListener","onchange_selectall","attachEvent","label","innerText","style","paddingRight","insertBefore","nextSibling","getElementById","closest","checked","this","checkbox"],"mappings":"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"}